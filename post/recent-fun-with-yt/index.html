<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Source Themes Academic 4.8.0"><meta name=author content="Matthew Turk"><meta name=description content="I&rsquo;ve recently been having fun with yt again. Really, though, I&rsquo;ve been having fun exploring the ways I can use it from different perspectives, and using it to teach myself the library textual."><link rel=alternate hreflang=en-us href=https://matthewturk.github.io/post/recent-fun-with-yt/><meta name=theme-color content="#EF525B"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css crossorigin=anonymous title=hl-light><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css crossorigin=anonymous title=hl-dark disabled><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin=anonymous><script src=https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin=anonymous async></script>
<link rel=stylesheet href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap"><link rel=stylesheet href=/css/academic.css><script async src="https://www.googletagmanager.com/gtag/js?id=UA-141183895-1"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}function trackOutboundLink(e,t){gtag("event","click",{event_category:"outbound",event_label:e,transport_type:"beacon",event_callback:function(){t!=="_blank"&&(document.location=e)}}),console.debug("Outbound link clicked: "+e)}function onClickCallback(e){if(e.target.tagName!=="A"||e.target.host===window.location.host)return;trackOutboundLink(e.target,e.target.getAttribute("target"))}gtag("js",new Date),gtag("config","UA-141183895-1",{anonymize_ip:!0}),document.addEventListener("click",onClickCallback,!1)</script><link rel=manifest href=/index.webmanifest><link rel=icon type=image/png href=/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_192x192_fill_lanczos_center_3.png><link rel=canonical href=https://matthewturk.github.io/post/recent-fun-with-yt/><meta property="twitter:card" content="summary"><meta property="twitter:site" content="@powersoffour"><meta property="twitter:creator" content="@powersoffour"><meta property="og:site_name" content="mjt"><meta property="og:url" content="https://matthewturk.github.io/post/recent-fun-with-yt/"><meta property="og:title" content="Recent Fun With yt | mjt"><meta property="og:description" content="I&rsquo;ve recently been having fun with yt again. Really, though, I&rsquo;ve been having fun exploring the ways I can use it from different perspectives, and using it to teach myself the library textual."><meta property="og:image" content="https://matthewturk.github.io/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_512x512_fill_lanczos_center_3.png"><meta property="twitter:image" content="https://matthewturk.github.io/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_512x512_fill_lanczos_center_3.png"><meta property="og:locale" content="en-us"><meta property="article:published_time" content="2023-06-06T11:54:08-05:00"><meta property="article:modified_time" content="2023-06-06T11:56:34-05:00"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://matthewturk.github.io/post/recent-fun-with-yt/"},"headline":"Recent Fun With yt","datePublished":"2023-06-06T11:54:08-05:00","dateModified":"2023-06-06T11:56:34-05:00","author":{"@type":"Person","name":"Matthew Turk"},"publisher":{"@type":"Organization","name":"mjt","logo":{"@type":"ImageObject","url":"https://matthewturk.github.io/images/icon_hu0b7a4cb9992c9ac0e91bd28ffd38dd00_9727_192x192_fill_lanczos_center_3.png"}},"description":"I\u0026rsquo;ve recently been having fun with yt again. Really, though, I\u0026rsquo;ve been having fun exploring the ways I can use it from different perspectives, and using it to teach myself the library textual."}</script><script src=https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.1/cookieconsent.min.js integrity="sha256-5VhCqFam2Cn+yjw61zbBNrbHVJ6SRydPeKopYlngbiQ=" crossorigin=anonymous></script>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.1/cookieconsent.min.css integrity="sha256-zQ0LblD/Af8vOppw18+2anxsuaz3pWYyVWi+bTvTH8Q=" crossorigin=anonymous><script>window.addEventListener("load",function(){window.cookieconsent.initialise({palette:{popup:{background:"#EF525B",text:"#EAE7D6"},button:{background:"#EAE7D6",text:"#EF525B"}},theme:"classic",content:{message:"This website uses cookies to ensure you get the best experience on our website.",dismiss:"Got it!",link:"Learn more",href:"https://www.cookiesandyou.com"}})})</script><title>Recent Fun With yt | mjt</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents><aside class=search-results id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Search</h1></div><div class="col-6 col-search-close"><a class=js-search href=#><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box><input name=q id=search-query placeholder=Search... autocapitalize=off autocomplete=off autocorrect=off spellcheck=false type=search></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>mjt</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>mjt</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/#about><span>Home</span></a></li><li class=nav-item><a class=nav-link href=/#posts><span>Posts</span></a></li><li class=nav-item><a class=nav-link href=/#projects><span>Projects</span></a></li><li class=nav-item><a class=nav-link href=/#courses><span>Courses</span></a></li><li class=nav-item><a class=nav-link href=/#talks><span>Talks</span></a></li><li class=nav-item><a class=nav-link href=/#publications><span>Publications</span></a></li><li class=nav-item><a class=nav-link href=/#contact><span>Contact</span></a></li><li class=nav-item><a class=nav-link href=https://data-exp-lab.github.io/ target=_blank rel=noopener><span>Research Group</span></a></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=Search><i class="fas fa-search" aria-hidden=true></i></a></li></ul></div></nav><article class=article><div class="article-container pt-3"><h1>Recent Fun With yt</h1><div class=article-metadata><span class=article-date>Last updated on
Jun 6, 2023</span></div></div><div class=article-container><div class=article-style><p>I&rsquo;ve recently been having fun with
<a href=https://yt-project.org/ target=_blank rel=noopener>yt</a> again. Really, though, I&rsquo;ve been having fun exploring the ways I can use it from different perspectives, and using it to teach myself the library
<a href=https://textual.textualize.io/ target=_blank rel=noopener>textual</a>.</p><p>A long, long time ago, when we were much younger (around the time Streetlight Manifesto put out their first album, &ldquo;Everything Goes Numb&rdquo;) I started trying to learn and use
<a href=https://enzo-project.org/ target=_blank rel=noopener>Enzo</a>. Enzo outputs data in patch-structured refinement, so you have grids that overlap and whatnot and aren&rsquo;t all the same size. The way it outputs it to disk is with a <code>.hierarchy</code> file, which is essentially a serialization of the simulation code &lsquo;walking&rsquo; the hierarchy. So, it outputs grid information, like so:</p><pre><code>Grid = 1
Task              = 0
GridRank          = 3
GridDimension     = 38 38 38 
GridStartIndex    = 3 3 3 
GridEndIndex      = 34 34 34 
GridLeftEdge      = 0 0 0 
GridRightEdge     = 1 1 1 
Time              = 0.0060000200028298
SubgridsAreStatic = 0
NumberOfBaryonFields = 24
FieldType = 0 4 5 6 1 49 50 51 52 53 7 8 9 10 11 12 23 24 25 27 19 61 62 83 
BaryonFileName = ./DD0030/galaxy0030.cpu0000
CourantSafetyNumber    = 0.300000
PPMFlatteningParameter = 0
PPMDiffusionParameter  = 0
PPMSteepeningParameter = 0
NumberOfParticles   = 0
GravityBoundaryType = 1
Pointer: Grid[1]-&gt;NextGridThisLevel = 0
Pointer: Grid[1]-&gt;NextGridNextLevel = 2
</code></pre><p>This is the first grid in my old favorite, <code>IsolatedGalaxy</code>. The various parameters include things like the position of the grid in space and so forth, and then at the end, we have these two pointers to the next grid on <em>this</em> level and the next grid on the <em>next</em> level. These two lines are the way that Enzo communicates parentage relationships (and note that <code>Level</code> is not in the block &ndash; you track which level things are on by walking the hierarchy.) The first line here indicates that there are no additional grids on this level, and the second line indicates that the next level starts with grid index 2. The grids are always ordered in this way &ndash; siblings first, then children. That&rsquo;s how you end up with blocks like this:</p><pre><code>Grid = 19
Task              = 5
GridRank          = 3
GridDimension     = 14 10 14 
GridStartIndex    = 3 3 3 
GridEndIndex      = 10 6 10 
GridLeftEdge      = 0.52734375 0.53515625 0.505859375 
GridRightEdge     = 0.53515625 0.5390625 0.513671875 
Time              = 0.0060000200028298
SubgridsAreStatic = 0
NumberOfBaryonFields = 24
FieldType = 0 4 5 6 1 49 50 51 52 53 7 8 9 10 11 12 23 24 25 27 19 61 62 83 
BaryonFileName = ./DD0030/galaxy0030.cpu0005
CourantSafetyNumber    = 0.300000
PPMFlatteningParameter = 0
PPMDiffusionParameter  = 0
PPMSteepeningParameter = 0
NumberOfParticles   = 50
ParticleFileName = ./DD0030/galaxy0030.cpu0005
GravityBoundaryType = 2
Pointer: Grid[19]-&gt;NextGridThisLevel = 0
Pointer: Grid[19]-&gt;NextGridNextLevel = 0
Pointer: Grid[18]-&gt;NextGridNextLevel = 0
Pointer: Grid[17]-&gt;NextGridNextLevel = 0
Pointer: Grid[16]-&gt;NextGridNextLevel = 0
Pointer: Grid[15]-&gt;NextGridNextLevel = 20
</code></pre><p>Here, we are in grid 19, but it doesn&rsquo;t have any <em>additional</em> siblings, and it also doesn&rsquo;t have any children. Grids 18, 17, and 16 also do not have any child grids, but 15 does.</p><p>As you might imagine, while this makes sense and is also straightforward to de-serialize into an in-memory data structure, it can be somewhat tricky to navigate if you just want info about a particular grid and its relationship to other grids.</p><p>Enter, Britton Smith! Britton, who I had the pleasure of attending graduate school with (and, also, continuing to work with up to and including the present day), was a really slick perl script writer.</p><p>(His perl implementation of battleship, including socket communication across LAN machines and a high score table, was a fixture among the PSU astro grads.)</p><p>Britton wrote up a tool to parse the hierarchy and, if I am remembering correctly, present a simple REPL to query for information about the individual grids. Years later he helped me port this concept to Python where it forms the initial indexing stage of the yt Enzo frontend.</p><p>A little while ago, I saw
<a href=https://mastodon.social/@glyph/110431920038948565 target=_blank rel=noopener>a toot</a> by Glyph Lefkowitz that made me realize I really ought to give a look at
<a href=https://textual.textualize.io/ target=_blank rel=noopener>textual</a> again.</p><p>So I built out a very simple Enzo hierarchy explorer that used yt, to try to evoke the old perl script. And it turns out, it was &mldr; incredibly easy!</p><p>I ended up putting it on GitHub at
<a href=https://github.com/matthewturk/yt_hierarchy_browser target=_blank rel=noopener>matthewturk/yt_hierarchy_browser</a>. I&rsquo;ve started exploring using things like
<a href=https://github.com/darrenburns/rich-pixels target=_blank rel=noopener>rich-pixels</a> to display grid slices, but I started to get lost in the &ldquo;messages flow up and properties flow down&rdquo; side of things, and making sure that I had the grid images properly stored in the right places. I will probably come back to that.</p><p>For now, though, the basics of the app are reasonably small &ndash; three basic components. The first is the <code>App</code> subclass, which sets up the tree viewer on the left and the grid info viewer on the right:</p><pre><code class=language-python>class DatasetBrowser(App):
    CSS_PATH = &quot;yt_hierarchy_browser.css&quot;

    def compose(self) -&gt; ComposeResult:
        yield Header()
        yield Footer()
        yield GridHierarchyBrowser()
        yield GridViewer()

    def on_mount(self) -&gt; None:
        ghv = self.query_one(GridHierarchyBrowser)
        ds = yt.load_sample(&quot;IsolatedGalaxy&quot;)
        assert ds is not None
        ghv.dataset = ds

    def on_tree_node_highlighted(self, event: Tree.NodeHighlighted) -&gt; None:
        if event.node.data is None: return
        gv = self.query_one(GridViewer)
        gv.grid = event.node.data['grid']

</code></pre><p>(I&rsquo;m not sure I&rsquo;ve put my tree node highlighted event handler in the right level of the class structure, but like I said, I&rsquo;m still learning!) This then creates a <code>GridViewer</code> which handles the display whenever a grid is highlighted:</p><pre><code class=language-python>class GridViewer(Static):
    grid: reactive[AMRGridPatch | None] = reactive(None)

    def compose(self):
        yield Static(id = &quot;grid_info&quot;)
        yield Static(id = &quot;grid_view&quot;)

    def watch_grid(self, grid: AMRGridPatch) -&gt; None:
        if grid is None: return
        grid_info = self.query_one(&quot;#grid_info&quot;)
        grid_info.update(f&quot;Left Edge: {grid.LeftEdge}\n&quot;
                         f&quot;Right Edge: {grid.RightEdge}\n&quot;
                         f&quot;Active Dimensions: {grid.ActiveDimensions}\n&quot;
                         f&quot;Level: {grid.Level}\n&quot;)
</code></pre><p>Note here that it&rsquo;s getting a grid patch, which gets updated &ndash; I could also do this with the tree node data, but here I&rsquo;m passing the grids so that when I do image display it&rsquo;s a bit easier. And finally, the tree viewer itself:</p><pre><code class=language-python>class GridHierarchyBrowser(Static):
    dataset: reactive[Dataset | None] = reactive(None)

    def compose(self) -&gt; ComposeResult:
        yield Tree(label = &quot;Grid Hierarchy&quot;, id = &quot;grid_hierarchy&quot;)

    def watch_dataset(self, dataset: Dataset) -&gt; None:
        if dataset is None: return
        def dictify(g):
            return {'ActiveDimensions': g.ActiveDimensions,
                    'LeftEdge': g.LeftEdge,
                    'RightEdge': g.RightEdge,
                    'Level': g.Level,
                    'grid': g}
        tree: Tree[dict] = self.query_one(Tree)
        tree.root.expand()
        def add_children(node, g):
            data = dictify(g)
            if len(g.Children) == 0:
                node.add_leaf(str(g), data = data)
            else:
                n = node.add(str(g), data = data)
                for c in g.Children:
                    add_children(n, c)
        for grid in dataset.index.select_grids(0):
            # These are all the root grids
            node = tree.root.add(str(grid), data = dictify(grid), expand = True)
            for c in grid.Children:
                add_children(node, c)
</code></pre><p>Again, the creation of the <code>dict</code> is a bit redundant since I&rsquo;m also grabbing the grid info, but later on I hope that will come in useful. This simply watches the dataset and then fills up the nodes. And, this is what it looks like:</p><p>![[screenshot.svg]]</p><p>This was a pretty fun experiment, and I&rsquo;m pretty excited about exploring more with it.</p></div><div class="media author-card content-widget-hr"><img class="avatar mr-3 avatar-circle" src="https://s.gravatar.com/avatar/b279d746f54e2cd6062e8279a767c4bc?s=200')" alt="Matthew Turk"><div class=media-body><h5 class=card-title><a href=https://matthewturk.github.io/>Matthew Turk</a></h5><h6 class=card-subtitle>Assistant Professor of Information Sciences</h6><p class=card-text>I am interested in the intersection of data analysis, visualization and open source in the sciences.</p><ul class=network-icon aria-hidden=true><li><a href=mailto:matthewturk@gmail.com><i class="fas fa-envelope"></i></a></li><li><a href=https://twitter.com/powersoffour target=_blank rel=noopener><i class="fab fa-twitter"></i></a></li><li><a href="https://scholar.google.com/citations?user=QTmv2p0AAAAJ&amp;hl=en" target=_blank rel=noopener><i class="ai ai-google-scholar"></i></a></li><li><a href=https://github.com/matthewturk target=_blank rel=noopener><i class="fab fa-github"></i></a></li></ul></div></div></div></article><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/python.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin=anonymous></script>
<script>const code_highlighting=!0</script><script>const isSiteThemeDark=!1</script><script>const search_config={indexURI:"/index.json",minLength:1,threshold:.3},i18n={no_results:"No results found",placeholder:"Search...",results:"results found"},content_type={post:"Posts",project:"Projects",publication:"Publications",talk:"Talks",slides:"Slides"}</script><script id=search-hit-fuse-template type=text/x-template>
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script><script src=https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin=anonymous></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin=anonymous></script>
<script src=/js/academic.min.cd45a9c0bbdd3dfb1c126917c601c9f2.js></script><div class=container><footer class=site-footer><p class=powered-by></p><p class=powered-by>Powered by the
<a href=https://sourcethemes.com/academic/ target=_blank rel=noopener>Academic theme</a> for
<a href=https://gohugo.io target=_blank rel=noopener>Hugo</a>.
<span class=float-right aria-hidden=true><a href=# class=back-to-top><span class=button_icon><i class="fas fa-chevron-up fa-2x"></i></span></a></span></p></footer></div><div id=modal class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><h5 class=modal-title>Cite</h5><button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&#215;</span></button></div><div class=modal-body><pre><code class="tex hljs"></code></pre></div><div class=modal-footer><a class="btn btn-outline-primary my-1 js-copy-cite" href=# target=_blank><i class="fas fa-copy"></i> Copy</a>
<a class="btn btn-outline-primary my-1 js-download-cite" href=# target=_blank><i class="fas fa-download"></i> Download</a><div id=modal-error></div></div></div></div></div></body></html>